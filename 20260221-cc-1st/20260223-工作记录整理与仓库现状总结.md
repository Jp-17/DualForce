# DualForce ä»“åº“å·¥ä½œè®°å½•æ•´ç†ä¸ç°çŠ¶æ€»ç»“

> æ•´ç†æ—¥æœŸï¼š2026-02-23
> è¦†ç›–èŒƒå›´ï¼šä» commit `af7e77a2`ï¼ˆ"æ·»åŠ proposal"ï¼‰å¾€åçš„æ‰€æœ‰æäº¤ï¼Œä»¥åŠ cc_todo ä¸‹å…¨éƒ¨æ–‡æ¡£è®°å½•
> æ•´ç†äººï¼šClaude Sonnet 4.6ï¼ˆæ ¹æ®å·²æœ‰æ–‡æ¡£ä¸ git log æ±‡æ€»ï¼‰

---

## ä¸€ã€èƒŒæ™¯è¯´æ˜

æœ¬æ–‡æ¡£åŸºäºä»¥ä¸‹æ¥æºæ•´ç†ï¼š

1. `cc_todo/` ç›®å½•ä¸‹ 5 ä»½å·²æœ‰æ–‡æ¡£ï¼ˆå…¨éƒ¨å†™äº 2026-02-21ï¼‰
2. `git log af7e77a2..HEAD` ä¸­çš„ 16 æ¡ git æäº¤è®°å½•
3. å„æäº¤çš„ diff å†…å®¹

ä» commit `af7e77a2`ï¼ˆ"æ·»åŠ  proposal"ï¼‰å¾€åï¼Œåœ¨ **2026-02-21 å•æ—¥å†…**å®Œæˆäº†å¤§é‡å·¥ä½œï¼Œå…±äº§ç”Ÿ **16 æ¬¡æäº¤**ï¼Œå˜æ›´ **~51 ä¸ªæ–‡ä»¶**ï¼Œæ–°å¢çº¦ **12,747 è¡Œä»£ç **ã€‚

---

## äºŒã€ç¯å¢ƒæ­å»ºä¸ä¸‹è½½ï¼ˆå®é™…å®‰è£…/ä¸‹è½½äº†ä»€ä¹ˆã€æ”¾åœ¨å“ªé‡Œï¼‰

### 2.1 ç¡¬ä»¶ç¯å¢ƒ

| é¡¹ç›® | ä¿¡æ¯ |
|------|------|
| GPU | NVIDIA GeForce RTX 4090 Dï¼ˆ24GB æ˜¾å­˜ï¼‰ |
| CUDA | 12.4 |
| ç³»ç»Ÿ | Linux 5.15.0-94-generic |
| ç£ç›˜ï¼ˆautodl-tmpï¼‰ | æ€»é‡ 350GBï¼Œå½“æ—¶çº¦ 278GB å¯ç”¨ |

### 2.2 conda ç¯å¢ƒåˆ›å»º

åˆ›å»ºäº†åä¸º `mova` çš„ conda ç¯å¢ƒï¼š

```bash
source /root/miniconda3/etc/profile.d/conda.sh
conda create -n mova python=3.13 -y
```

- **ä½ç½®**ï¼š`/root/miniconda3/envs/mova/`
- **Python ç‰ˆæœ¬**ï¼š3.13ï¼ˆä¸ MOVA `pyproject.toml` ä¸­ `requires-python >= 3.12` ä¸€è‡´ï¼‰

### 2.3 Python ä¾èµ–å®‰è£…ï¼ˆåœ¨ mova ç¯å¢ƒä¸­ï¼‰

| åŒ… | ç‰ˆæœ¬ | å®‰è£…æ¥æº |
|----|------|---------|
| torch | 2.10.0 | PyTorch å®˜æ–¹ whl æº (`--index-url https://download.pytorch.org/whl/cu124`) |
| torchvision | 0.25.0 | åŒä¸Š |
| torchaudio | 2.10.0 | åŒä¸Š |
| diffusers | 0.36.0 | pip |
| transformers | 4.57.6 | pip |
| accelerate | 1.12.0 | pip |
| bitsandbytes | 0.49.2 | pipï¼ˆæ¨ç†æŠ¥é”™åè¡¥è£…ï¼ŒåŸå› ï¼šä»£ç æ— æ¡ä»¶å¯¼å…¥äº†è®­ç»ƒä¸“ç”¨æ¨¡å—ï¼‰ |
| movaï¼ˆæœ¬ä½“ï¼‰ | â€” | `pip install -e .`ï¼ˆä»é¡¹ç›®æ ¹ç›®å½•ä»¥å¯ç¼–è¾‘æ¨¡å¼å®‰è£…ï¼‰ |

> **æ³¨æ„**ï¼š`bitsandbytes` ä»…åœ¨ `pyproject.toml` çš„ `[train]` å¯é€‰ä¾èµ–ä¸­å£°æ˜ï¼Œä½† `mova/engine/optimizers/__init__.py` æ— æ¡ä»¶å¯¼å…¥ï¼Œå¯¼è‡´çº¯æ¨ç†ä¹Ÿä¼šæŠ¥ `ModuleNotFoundError`ã€‚è¿™æ˜¯ MOVA ä»£ç åº“çš„ä¸€ä¸ªè®¾è®¡ç¼ºé™·ï¼Œå·²æœ‰æ–‡æ¡£ä¸­è®°å½•äº†è¯¥é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚

### 2.4 MOVA-360p æ¨¡å‹æƒé‡ä¸‹è½½

ä½¿ç”¨ `hf-mirror.com`ï¼ˆå›½å†…åŠ é€Ÿï¼‰ä¸‹è½½ï¼š

```bash
HF_ENDPOINT=https://hf-mirror.com huggingface-cli download \
    OpenMOSS-Team/MOVA-360p \
    --local-dir /root/autodl-tmp/checkpoints/MOVA-360p
```

- **ä¸‹è½½ä½ç½®**ï¼š`autodl-tmp/checkpoints/MOVA-360p/`
- **æ€»å¤§å°**ï¼šçº¦ 50GBï¼ˆä¸‹è½½è€—æ—¶çº¦ 78 åˆ†é’Ÿï¼‰

ä¸‹è½½çš„æ¨¡å‹ç»“æ„ï¼ˆå„ç»„ä»¶ä½ç½®ï¼‰ï¼š

```
autodl-tmp/checkpoints/MOVA-360p/
â”œâ”€â”€ model_index.json
â”œâ”€â”€ README.md
â”œâ”€â”€ scheduler/scheduler_config.json
â”œâ”€â”€ tokenizer/
â”œâ”€â”€ text_encoder/
â”‚   â”œâ”€â”€ model-00001-of-00003.safetensors  (~4.6GB)
â”‚   â”œâ”€â”€ model-00002-of-00003.safetensors  (~4.7GB)
â”‚   â””â”€â”€ model-00003-of-00003.safetensors  (~1.4GB)
â”œâ”€â”€ audio_dit/
â”‚   â””â”€â”€ diffusion_pytorch_model.safetensors  (~2.7GB)
â”œâ”€â”€ audio_vae/
â”‚   â””â”€â”€ diffusion_pytorch_model.safetensors
â”œâ”€â”€ video_dit/
â”‚   â”œâ”€â”€ diffusion_pytorch_model-00001-of-00003.safetensors
â”‚   â”œâ”€â”€ diffusion_pytorch_model-00002-of-00003.safetensors
â”‚   â””â”€â”€ diffusion_pytorch_model-00003-of-00003.safetensors
â”œâ”€â”€ video_dit_2/
â”‚   â”œâ”€â”€ diffusion_pytorch_model-00001-of-00003.safetensors
â”‚   â”œâ”€â”€ diffusion_pytorch_model-00002-of-00003.safetensors
â”‚   â””â”€â”€ diffusion_pytorch_model-00003-of-00003.safetensors
â”œâ”€â”€ video_vae/
â”‚   â””â”€â”€ diffusion_pytorch_model.safetensors
â””â”€â”€ dual_tower_bridge/
    â””â”€â”€ diffusion_pytorch_model.safetensors  (~5.0GB)
```

**é‡è¦å‘ç°**ï¼šé€šè¿‡å¯¹ checkpoint å®é™…é…ç½®çš„æ£€æŸ¥ï¼Œå‘ç° MOVA-360p çœŸå®æ¶æ„å‚æ•°ä¸ä»£ç é»˜è®¤å€¼æœ‰é‡å¤§å·®å¼‚ï¼š

| å‚æ•° | ä»£ç é»˜è®¤å€¼ | å®é™… checkpoint å€¼ |
|------|-----------|------------------|
| dim | 3072 | **5120** |
| å±‚æ•° | 30 | **40** |
| patch_size | (2,2,2) | **(1,2,2)** |
| bridge ç­–ç•¥ | shallow_focus | **full** |
| audio é‡‡æ ·ç‡ | 44.1kHz/2048 hop | **48kHz/960 hop** |

### 2.5 æ¨ç†æµ‹è¯•

æˆåŠŸæ‰§è¡Œ MOVA æ¨ç†ï¼ˆä½¿ç”¨ `--offload group` ç­–ç•¥ï¼Œä»…éœ€ 12GB æ˜¾å­˜ï¼‰ï¼š

```bash
torchrun --nproc_per_node=1 scripts/inference_single.py \
    --ckpt_path autodl-tmp/checkpoints/MOVA-360p/ \
    --offload group \
    --output_path ./data/samples/single_person.mp4
```

- **è¾“å‡ºæ–‡ä»¶**ï¼š`./data/samples/single_person.mp4`ï¼ˆ4.0MBï¼Œç”ŸæˆæˆåŠŸï¼‰

---

## ä¸‰ã€ä»“åº“ä»£ç å˜æ›´è¯¦æƒ…ï¼ˆ16 æ¬¡ git æäº¤ï¼‰

### 3.1 æäº¤æ€»è§ˆ

| æäº¤ Hash | æ—¶é—´ | æäº¤ä¿¡æ¯ | æ–‡ä»¶æ•° | æ–°å¢è¡Œæ•° |
|-----------|------|---------|-------|---------|
| `a14eb9a` | 14:54 | Add project analysis and execution plan docs | 4 | +897 |
| `f505ce6` | 15:15 | Add DualForce core architecture: struct DiT, DF scheduler, training pipeline | 9 | +1,503 |
| `7567c46` | 15:35 | Add dataset, preprocessing pipeline, causal attention, and KV-cache | 15 | +2,169 |
| `222b2ed` | 15:53 | Add training/inference scripts, factory function, and trainer generalization | 8 | +961 |
| `eeb1c46` | 15:55 | Update progress log: Phase 1 architecture complete (pending GPU verification) | 1 | +93 |
| `b4d5899` | 16:40 | Add FSDP config, launch script; finalize Phase 1 code completion | 4 | +125 |
| `98aefc6` | 16:58 | Fix bugs, add verification scripts and HDTF download tool | 7 | +1,234 |
| `5f404cf` | 17:02 | Add CelebV-HQ download script and environment setup | 2 | +431 |
| `9b5bcd7` | 17:18 | Add audio conditioning module and per-frame AdaLN (Phase 3) | 4 | +440 |
| `6f502db` | 17:19 | Update progress log: Phase 3 audio conditioning complete | 1 | +37 |
| `7056b56` | 17:26 | Add evaluation pipeline: FVD, FID, ACD/CSIM, Sync-C/D, APD (Phase 5) | 6 | +1,673 |
| `5a9d66b` | 17:28 | Rewrite inference pipeline with dual-tower, CFG, audio conditioning | 1 | +304ï¼ˆå‡€å¢ï¼‰ |
| `160d2e2` | 17:45 | Add batch generation script, cleanup unused import, update progress log | 3 | +379 |
| `e13d88d` | 17:48 | Implement FLAME alignment and lip-sync contrastive losses | 2 | +107 |
| `dcf39f1` | 18:06 | Add ablation study configs for 5 key experiments (Phase 5.2) | 7 | +241 |
| `d42f720` | 18:07 | Update progress log: all pre-GPU code complete | 1 | +75 |

**å…¨éƒ¨æäº¤ä½œè€…**ï¼š`Jp-17 <jpagkr@163.com>`ï¼ŒCo-authored by `Claude Opus 4.6`

---

### 3.2 å„æäº¤è¯¦ç»†å†…å®¹

#### `a14eb9a` â€” æ·»åŠ é¡¹ç›®åˆ†æå’Œæ‰§è¡Œè®¡åˆ’æ–‡æ¡£ï¼ˆ14:54ï¼‰

æ–°å»º 4 ä»½æ–‡æ¡£è‡³ `cc_todo/`ï¼š

- `cc_todo/2026-02-21-MOVA-ç¯å¢ƒæ­å»ºä¸æ¨ç†æµ‹è¯•.md` â€” MOVA ç¯å¢ƒæ­å»ºä¸æ¨ç†è®°å½•
- `cc_todo/20260221-dualforce-execution-plan.md` â€” DualForce 6 é˜¶æ®µæ‰§è¡Œè®¡åˆ’
- `cc_todo/20260221-dualforce-progress-log.md` â€” è¿›åº¦æ—¥å¿—ï¼ˆåˆå§‹ç‰ˆæœ¬ï¼‰
- `cc_todo/20260221-mova-codebase-analysis.md` â€” MOVA ä»£ç åº“æ·±åº¦åˆ†æï¼ˆå« checkpoint çœŸå®å‚æ•°ä¿®æ­£ï¼‰

---

#### `f505ce6` â€” DualForce æ ¸å¿ƒæ¶æ„ï¼ˆ15:15ï¼‰

**æ–°å»ºæ–‡ä»¶**ï¼š

- `configs/dualforce/dualforce_train_8gpu.py`
  - MOVA-Lite è®­ç»ƒé…ç½®ï¼šdim=1536ã€20å±‚ã€heads=12ã€causal_temporal=Trueã€25fpsã€bridge ç­–ç•¥ shallow_focus
- `mova/diffusion/models/wan_struct_dit.py`ï¼ˆ304è¡Œï¼‰
  - `WanStructModel`ï¼š3D ç»“æ„ DiTï¼Œæ›¿ä»£åŸ MOVA éŸ³é¢‘å¡”ï¼›MLP tokenizerï¼Œ1D RoPE ä½ç½®ç¼–ç 
- `mova/diffusion/schedulers/diffusion_forcing.py`ï¼ˆ259è¡Œï¼‰
  - `DiffusionForcingScheduler`ï¼šæ¯å¸§ç‹¬ç«‹ sigma å™ªå£°æ°´å¹³ï¼Œæ”¯æŒæ»‘åŠ¨çª—å£æ¨ç†
- `mova/diffusion/pipelines/dualforce_train.py`ï¼ˆ608è¡Œï¼‰
  - `DualForceTrain`ï¼šåŒå¡”ï¼ˆè§†é¢‘å¡” + ç»“æ„å¡”ï¼‰å‰å‘ä¼ æ’­ã€bridge åŒå‘æ³¨æ„åŠ›ã€å¤šæ¨¡æ€æŸå¤±å‡½æ•°

**ä¿®æ”¹æ–‡ä»¶**ï¼š

- `mova/diffusion/models/__init__.py` â€” æ³¨å†Œ `WanStructModel`
- `mova/diffusion/schedulers/__init__.py` â€” æ³¨å†Œ `DiffusionForcingScheduler`
- `mova/diffusion/pipelines/__init__.py` â€” æ³¨å†Œ `DualForceTrain`
- `cc_todo/` æ–‡æ¡£ä¸­è¡¥å……äº†æ¶æ„å‚æ•°ä¿®æ­£ï¼ˆ5120-dim ç­‰ï¼‰

---

#### `7567c46` â€” æ•°æ®é›†ã€é¢„å¤„ç†æµæ°´çº¿ã€å› æœæ³¨æ„åŠ›ã€KV-cacheï¼ˆ15:35ï¼‰

**æ–°å»ºæ–‡ä»¶**ï¼š

- `mova/datasets/dualforce_dataset.py`ï¼ˆ252è¡Œï¼‰
  - `DualForceDataset`ï¼šä» `.safetensors` æ–‡ä»¶åŠ è½½é¢„æå–çš„å¤šæ¨¡æ€ç‰¹å¾
- `mova/diffusion/models/kv_cache.py`ï¼ˆ252è¡Œï¼‰
  - `MultiModalKVCache`ã€`CachedSelfAttention`ï¼šæ”¯æŒè‡ªå›å½’æ¨ç†æ—¶çš„ KV ç¼“å­˜
- `scripts/preprocess/01_face_detect_crop.py` â€” äººè„¸æ£€æµ‹ä¸è£å‰ª
- `scripts/preprocess/02_quality_filter.py` â€” è´¨é‡è¿‡æ»¤ï¼ˆæ¸…æ™°åº¦ã€å¸§æ•°ç­‰ï¼‰
- `scripts/preprocess/03_extract_video_latents.py` â€” Video VAE ç¼–ç 
- `scripts/preprocess/04_extract_struct_latents.py` â€” LivePortrait ç»“æ„ç‰¹å¾æå–
- `scripts/preprocess/05_extract_flame_params.py` â€” EMOCA FLAME å‚æ•°æå–
- `scripts/preprocess/06_extract_audio_features.py` â€” HuBERT éŸ³é¢‘ç‰¹å¾æå–
- `scripts/preprocess/07_build_metadata.py` â€” æ„å»ºå…ƒæ•°æ®ç´¢å¼•
- `scripts/preprocess/run_pipeline.sh` â€” 7æ­¥é¢„å¤„ç†æµæ°´çº¿ä¸€é”®è¿è¡Œè„šæœ¬

**ä¿®æ”¹æ–‡ä»¶**ï¼š

- `mova/diffusion/models/wan_video_dit.py` â€” æ–°å¢ `_build_block_causal_mask()` å’Œ `flash_attention_causal()` æ–¹æ³•ï¼Œæ·»åŠ  `causal_temporal` é…ç½®å‚æ•°ï¼ˆ+97 è¡Œï¼‰
- `mova/diffusion/pipelines/dualforce_train.py` â€” ä¼ æ’­ causal grid sizeï¼ˆ+25 è¡Œï¼‰
- `mova/datasets/__init__.py` â€” æ³¨å†Œ `DualForceDataset`

---

#### `222b2ed` â€” è®­ç»ƒ/æ¨ç†è„šæœ¬ã€å·¥å‚å‡½æ•°ã€è®­ç»ƒå™¨æ³›åŒ–ï¼ˆ15:53ï¼‰

**æ–°å»ºæ–‡ä»¶**ï¼š

- `mova/diffusion/pipelines/pipeline_dualforce.py`ï¼ˆ397è¡Œï¼‰
  - `DualForceInference`ï¼šæ»‘åŠ¨çª—å£è‡ªå›å½’æ¨ç†æµæ°´çº¿
- `scripts/dualforce_inference.py`ï¼ˆ145è¡Œï¼‰
  - CLI æ¨ç†å·¥å…·ï¼Œè¾“å…¥å‚è€ƒå›¾ + æ–‡æœ¬ prompt + éŸ³é¢‘ â†’ è¾“å‡ºè§†é¢‘
- `scripts/training_scripts/dualforce_train.py`ï¼ˆ159è¡Œï¼‰
  - Accelerate è®­ç»ƒå¯åŠ¨å™¨

**ä¿®æ”¹æ–‡ä»¶**ï¼š

- `mova/diffusion/pipelines/dualforce_train.py` â€” æ–°å¢ `DualForceTrain_from_pretrained` å·¥å‚å‡½æ•°ï¼Œæ³¨å†Œåˆ° `DIFFUSION_PIPELINES`ï¼ˆ+143 è¡Œï¼‰
- `mova/engine/trainer/accelerate/accelerate_trainer.py` â€” ä¿®æ”¹ä¸º batch-key æ— å…³ï¼ˆä¸ç¡¬ç¼–ç  "video" é”®ï¼‰ï¼Œæ–°å¢ DualForce è®­ç»ƒæŒ‡æ ‡è¾“å‡ºï¼ˆ-42/+58 è¡Œï¼‰
- `configs/dualforce/dualforce_train_8gpu.py` â€” æ›´æ–°ä¸ºé€šè¿‡ `diffusion_pipeline` å­—å…¸ä¼ é€’ç»„ä»¶é…ç½®

---

#### `eeb1c46` â€” æ›´æ–°è¿›åº¦æ—¥å¿—ï¼ˆ15:55ï¼‰

- æ›´æ–° `cc_todo/20260221-dualforce-progress-log.md`ï¼Œè®°å½• Session 4 å·¥ä½œï¼ˆå·¥å‚å‡½æ•°ã€æ¨ç†æµæ°´çº¿ã€è®­ç»ƒå™¨æ³›åŒ–ï¼‰ï¼ŒPhase 1 æ ‡è®°ä¸ºä»£ç å®Œæˆï¼ˆ+93 è¡Œï¼‰

---

#### `b4d5899` â€” FSDP é…ç½®å’Œå¯åŠ¨è„šæœ¬ï¼ˆ16:40ï¼‰

**æ–°å»ºæ–‡ä»¶**ï¼š

- `configs/dualforce/accelerate/fsdp_8gpu.yaml`
  - 8-GPU FSDP åˆ†å¸ƒå¼è®­ç»ƒé…ç½®ï¼šwrap ç­–ç•¥è¦†ç›– `DiTBlock + ConditionalCrossAttentionBlock`ï¼ŒContext Parallel=2ï¼ŒData Parallel=4ï¼Œbf16ï¼ŒCPU offload
- `scripts/training_scripts/dualforce_train_8gpu.sh`
  - ä½¿ç”¨ `accelerate launch` çš„ bash ä¸€é”®å¯åŠ¨è„šæœ¬

**ä¿®æ”¹æ–‡ä»¶**ï¼š

- æ‰§è¡Œè®¡åˆ’å’Œè¿›åº¦æ—¥å¿—æ›´æ–°ï¼Œæ ‡è®° Phase 1 ä»£ç å®Œæˆ

---

#### `98aefc6` â€” Bug ä¿®å¤ã€éªŒè¯è„šæœ¬ã€HDTF ä¸‹è½½å·¥å…·ï¼ˆ16:58ï¼‰

**ä¿®å¤çš„ Bug**ï¼š

- `dualforce_train.py`ï¼šå°†ç¡¬ç¼–ç  `"cuda"` ä¿®æ”¹ä¸ºåŠ¨æ€è®¾å¤‡æ£€æµ‹
- `dualforce_dataset.py`ï¼šä¿®å¤ loss placeholder dtype ä¸åŒ¹é…é—®é¢˜
- æ–°å¢å¯¹ `first_frame` ç¼ºå¤±æƒ…å†µçš„é”™è¯¯å¤„ç†

**æ–°å»ºæ–‡ä»¶**ï¼š

- `scripts/verify_dualforce.py`ï¼ˆ591è¡Œï¼‰
  - 6 é¡¹ GPU éªŒè¯æµ‹è¯•å¥—ä»¶ï¼šå‰å‘ä¼ æ’­ã€KV-cache ä¸€è‡´æ€§ã€å†…å­˜ä¼°ç®—ç­‰
- `scripts/verify_mova_inference.py`ï¼ˆ233è¡Œï¼‰
  - MOVA checkpoint å®Œæ•´æ€§æ£€æŸ¥ + æ¨ç†éªŒè¯
- `scripts/download/download_hdtf.py`ï¼ˆ352è¡Œï¼‰
  - yt-dlp å¹¶è¡Œä¸‹è½½ HDTF æ•°æ®é›† + è§†é¢‘åˆ‡ç‰‡æ ‡å‡†åŒ–

---

#### `5f404cf` â€” CelebV-HQ ä¸‹è½½è„šæœ¬ã€ç¯å¢ƒå®‰è£…è„šæœ¬ï¼ˆ17:02ï¼‰

**æ–°å»ºæ–‡ä»¶**ï¼š

- `scripts/download/download_celebvhq.py`ï¼ˆ266è¡Œï¼‰
  - æ”¯æŒæ–­ç‚¹ç»­ä¼ çš„ YouTube å¹¶è¡Œä¸‹è½½è„šæœ¬ï¼ˆç›®æ ‡ï¼šCelebV-HQ ~35K è§†é¢‘ï¼‰
- `scripts/setup_env.sh`ï¼ˆ165è¡Œï¼‰
  - ä¸€é”® conda ç¯å¢ƒå®‰è£…è„šæœ¬ï¼ˆPython 3.10ï¼ŒCUDA 12.1ï¼Œå« flash-attn ç­‰å¯é€‰ä¾èµ–ï¼‰

---

#### `9b5bcd7` â€” éŸ³é¢‘æ¡ä»¶åŒ–æ¨¡å—ã€per-frame AdaLNï¼ˆ17:18ï¼‰

**æ–°å»ºæ–‡ä»¶**ï¼š

- `mova/diffusion/models/audio_conditioning.py`ï¼ˆ361è¡Œï¼‰

  åŒ…å« 5 ä¸ªç±»ï¼š

  | ç±»å | åŠŸèƒ½ |
  |------|------|
  | `AudioProjector` | HuBERT 1024ç»´ â†’ 1536ç»´æŠ•å½± |
  | `AudioCondCrossAttention` | é—¨æ§äº¤å‰æ³¨æ„åŠ›ï¼ˆgate åˆå§‹åŒ–ä¸º 0ï¼Œè®­ç»ƒåˆæœŸæ— å½±å“ï¼‰ |
  | `AudioConditioningModule` | æµ…å±‚ 6 å±‚éŸ³é¢‘èåˆï¼Œé€šè¿‡ `F.interpolate` åšæ—¶åºå¯¹é½ |
  | `DualAdaLNZero` | æ¯å¸§ sigma â†’ æ­£å¼¦ç¼–ç  â†’ MLP â†’ 6*dim è°ƒåˆ¶å‘é‡ |
  | `PerFrameDiTBlockWrapper` | å°† DualAdaLNZero åŒ…è£…åˆ° DiT block |

**ä¿®æ”¹æ–‡ä»¶**ï¼š

- `mova/diffusion/pipelines/dualforce_train.py` â€” åœ¨ `forward_dual_tower` å’Œ `training_step` ä¸­é›†æˆéŸ³é¢‘æ¡ä»¶åŒ–ï¼ˆ+63 è¡Œï¼‰
- `configs/dualforce/dualforce_train_8gpu.py` â€” æ–°å¢ `audio_conditioning_config`ï¼Œæ‰©å±• `train_modules`
- `mova/diffusion/models/__init__.py` â€” æ³¨å†Œæ–°æ¨¡å—

---

#### `6f502db` â€” è¿›åº¦æ—¥å¿—æ›´æ–°ï¼ˆ17:19ï¼‰

- è®°å½• Session 7 å·¥ä½œï¼ˆéŸ³é¢‘æ¡ä»¶åŒ–è®¾è®¡ä¸é›†æˆï¼‰ï¼Œ+37 è¡Œ

---

#### `7056b56` â€” è¯„ä¼°æµæ°´çº¿ï¼ˆ17:26ï¼‰

**æ–°å»ºæ–‡ä»¶ï¼ˆå…¨éƒ¨ä½äº `scripts/eval/`ï¼‰**ï¼š

| è„šæœ¬ | è¡Œæ•° | åŠŸèƒ½ |
|------|------|------|
| `compute_fvd.py` | 198 | FVDï¼ˆè§†é¢‘è´¨é‡ï¼‰ï¼šR3D-18 ç‰¹å¾ |
| `compute_fid.py` | 194 | FIDï¼ˆå¸§è´¨é‡ï¼‰ï¼šInception-v3 |
| `compute_identity.py` | 256 | ACD/CSIMï¼ˆèº«ä»½ä¿æŒï¼‰ï¼šArcFaceï¼ˆinsightfaceï¼‰ |
| `compute_sync.py` | 353 | Sync-C/Sync-Dï¼ˆå”‡éŸ³åŒæ­¥ï¼‰ï¼šSyncNet + MFCC |
| `compute_pose.py` | 289 | APDï¼ˆå¤´éƒ¨å§¿æ€åå·®ï¼‰ï¼šMediaPipe solvePnP |
| `run_eval.py` | 383 | è¯„ä¼°ç¼–æ’å™¨ï¼Œæ”¯æŒç«¯åˆ°ç«¯å’Œçº¯æŒ‡æ ‡ä¸¤ç§æ¨¡å¼ |

---

#### `5a9d66b` â€” æ¨ç†æµæ°´çº¿é‡å†™ï¼ˆ17:28ï¼‰

**ä¿®æ”¹æ–‡ä»¶**ï¼š

- `mova/diffusion/pipelines/pipeline_dualforce.py` â€” å¤§å¹…é‡å†™ï¼ˆå‡€å¢ 304 è¡Œï¼Œåˆ é™¤ 91 è¡Œï¼‰ï¼š
  - å®Œæ•´åŒå¡”å‰å‘ä¼ æ’­ï¼ˆè§†é¢‘å¡” + ç»“æ„å¡” + bridgeï¼‰
  - CFGï¼ˆClassifier-Free Guidanceï¼‰æ”¯æŒè´Ÿ prompt
  - æµ…å±‚éŸ³é¢‘æ¡ä»¶åŒ–é›†æˆ
  - per-frame `DualAdaLNZero` è°ƒåˆ¶
  - ä¿®å¤ç¡¬ç¼–ç  `"cuda"`
  - å®Œå–„ patchify/unpatchify å’Œç»“æ„æ½œå˜é‡ç”Ÿæˆ

---

#### `160d2e2` â€” æ‰¹é‡ç”Ÿæˆè„šæœ¬ã€æ¸…ç†ã€è¿›åº¦æ›´æ–°ï¼ˆ17:45ï¼‰

**æ–°å»ºæ–‡ä»¶**ï¼š

- `scripts/eval/batch_generate.py`ï¼ˆ300è¡Œï¼‰
  - æ‰¹é‡æ¨ç†è„šæœ¬ï¼Œç”¨äºè¯„ä¼°é›†çš„å¤§è§„æ¨¡ç”Ÿæˆ

**ä¿®æ”¹æ–‡ä»¶**ï¼š

- `mova/diffusion/models/wan_struct_dit.py` â€” åˆ é™¤æœªä½¿ç”¨çš„ einops å¯¼å…¥
- `cc_todo/20260221-dualforce-progress-log.md` â€” Session 8 è®°å½•ï¼ˆ+80 è¡Œï¼‰

---

#### `e13d88d` â€” FLAME å¯¹é½æŸå¤±ã€å”‡éŸ³åŒæ­¥å¯¹æ¯”æŸå¤±ï¼ˆ17:48ï¼‰

**ä¿®æ”¹æ–‡ä»¶**ï¼š

- `mova/diffusion/pipelines/dualforce_train.py` â€” å°†ä¸¤å¤„ `TODO` å ä½ç¬¦æ›¿æ¢ä¸ºçœŸå®å®ç°ï¼ˆ+110 è¡Œï¼‰ï¼š

  **L_flameï¼ˆFLAME å¯¹é½æŸå¤±ï¼‰**ï¼š
  - é€šè¿‡æµåŒ¹é…é€†å‘ä¼°è®¡å¹²å‡€ç»“æ„ xâ‚€
  - çº¿æ€§æŠ•å½±ï¼ˆ128â†’159 ç»´ï¼‰
  - MSE(é¢„æµ‹ FLAME å‚æ•°, GT FLAME å‚æ•°)

  **L_lip_syncï¼ˆå”‡éŸ³åŒæ­¥å¯¹æ¯”æŸå¤±ï¼‰**ï¼š
  - 256 ç»´å…±äº«åµŒå…¥ç©ºé—´
  - è§†é¢‘æ½œå˜é‡ç‰¹å¾ vs HuBERT éŸ³é¢‘ç‰¹å¾
  - åŒå¸§ä¸ºæ­£æ ·æœ¬ï¼Œéå¯¹è§’çº¿ä¸ºè´Ÿæ ·æœ¬ï¼ˆInfoNCE é£æ ¼ï¼‰

---

#### `dcf39f1` â€” æ¶ˆèå®éªŒé…ç½®ï¼ˆ18:06ï¼‰

**æ–°å»ºæ–‡ä»¶ï¼ˆå…¨éƒ¨ä½äº `configs/dualforce/ablations/`ï¼‰**ï¼š

| æ–‡ä»¶ | æ¶ˆèå†…å®¹ |
|------|---------|
| `no_struct_stream.py` | ç§»é™¤ 3D ç»“æ„å¡”ï¼ˆçº¯è§†é¢‘åŸºçº¿ï¼‰ |
| `unidirectional_bridge.py` | Bridge æ”¹ä¸ºå•å‘ï¼ˆä»…ç»“æ„â†’è§†é¢‘ï¼Œæ— åå‘ï¼‰ |
| `fusion_depth_4.py` | æµ…èåˆï¼šä»…å‰ 4 å±‚ bridge äº¤äº’ |
| `fusion_depth_12.py` | æ·±èåˆï¼šå‰ 12 å±‚ bridge äº¤äº’ |
| `sigma_s_0.5.py` | ç»“æ„å¡”å™ªå£°èŒƒå›´ Ïƒ_s âˆˆ [0, 0.5] |
| `sigma_s_1.0.py` | ç»“æ„å¡”å™ªå£°èŒƒå›´ Ïƒ_s âˆˆ [0, 1.0] |
| `long_sequence_eval.py` | é•¿åºåˆ—è¯„ä¼°ï¼š32/128/256/512 å¸§ |

---

#### `d42f720` â€” æœ€ç»ˆçŠ¶æ€æ›´æ–°ï¼ˆ18:07ï¼‰

- æ›´æ–°è¿›åº¦æ—¥å¿—ï¼Œå®Œæ•´æ•´ç†æ‰€æœ‰æ¨¡å—å®Œæˆåº¦è¡¨æ ¼ã€GPU-required å¾…åšäº‹é¡¹ã€å®Œæ•´ commit å†å²ï¼ˆ+75 è¡Œï¼‰

---

## å››ã€æ–°å»ºæ–‡ä»¶æ¸…å•ï¼ˆæŒ‰ç›®å½•å½’ç±»ï¼‰

### æ–‡æ¡£ï¼ˆcc_todo/ï¼‰

```
cc_todo/
â”œâ”€â”€ 2026-02-21-MOVA-ç¯å¢ƒæ­å»ºä¸æ¨ç†æµ‹è¯•.md
â”œâ”€â”€ 20260221-dualforce-execution-plan.md
â”œâ”€â”€ 20260221-dualforce-progress-log.md
â”œâ”€â”€ 20260221-dualforce-é¡¹ç›®æ€»è§ˆ.md
â””â”€â”€ 20260221-mova-codebase-analysis.md
```

### è®­ç»ƒé…ç½®ï¼ˆconfigs/dualforce/ï¼‰

```
configs/dualforce/
â”œâ”€â”€ dualforce_train_8gpu.py
â”œâ”€â”€ accelerate/fsdp_8gpu.yaml
â””â”€â”€ ablations/
    â”œâ”€â”€ no_struct_stream.py
    â”œâ”€â”€ unidirectional_bridge.py
    â”œâ”€â”€ fusion_depth_4.py
    â”œâ”€â”€ fusion_depth_12.py
    â”œâ”€â”€ sigma_s_0.5.py
    â”œâ”€â”€ sigma_s_1.0.py
    â””â”€â”€ long_sequence_eval.py
```

### æ¨¡å‹ä»£ç ï¼ˆmova/diffusion/models/ï¼‰

```
mova/diffusion/models/
â”œâ”€â”€ wan_struct_dit.py          # 3D ç»“æ„ DiTï¼ˆæ›¿ä»£éŸ³é¢‘å¡”ï¼‰
â”œâ”€â”€ kv_cache.py                # è‡ªå›å½’ KV-Cache
â””â”€â”€ audio_conditioning.py      # éŸ³é¢‘æ¡ä»¶åŒ– + DualAdaLNZero
```

### è°ƒåº¦å™¨ï¼ˆmova/diffusion/schedulers/ï¼‰

```
mova/diffusion/schedulers/
â””â”€â”€ diffusion_forcing.py       # æ¯å¸§ç‹¬ç«‹ sigma è°ƒåº¦å™¨
```

### æµæ°´çº¿ï¼ˆmova/diffusion/pipelines/ï¼‰

```
mova/diffusion/pipelines/
â”œâ”€â”€ dualforce_train.py         # è®­ç»ƒæµæ°´çº¿ï¼ˆå«æŸå¤±å‡½æ•°ï¼‰
â””â”€â”€ pipeline_dualforce.py      # æ¨ç†æµæ°´çº¿ï¼ˆæ»‘åŠ¨çª—å£ + CFGï¼‰
```

### æ•°æ®é›†ï¼ˆmova/datasets/ï¼‰

```
mova/datasets/
â””â”€â”€ dualforce_dataset.py       # å¤šæ¨¡æ€æ•°æ®é›†ï¼ˆè¯»å– .safetensorsï¼‰
```

### è„šæœ¬

```
scripts/
â”œâ”€â”€ dualforce_inference.py          # æ¨ç† CLI
â”œâ”€â”€ verify_dualforce.py             # GPU 6é¡¹éªŒè¯æµ‹è¯•
â”œâ”€â”€ verify_mova_inference.py        # MOVA æ¨ç†éªŒè¯
â”œâ”€â”€ setup_env.sh                    # ä¸€é”® conda ç¯å¢ƒå®‰è£…
â”œâ”€â”€ training_scripts/
â”‚   â”œâ”€â”€ dualforce_train.py          # è®­ç»ƒå¯åŠ¨å™¨
â”‚   â””â”€â”€ dualforce_train_8gpu.sh     # 8-GPU bash å¯åŠ¨è„šæœ¬
â”œâ”€â”€ preprocess/
â”‚   â”œâ”€â”€ 01_face_detect_crop.py
â”‚   â”œâ”€â”€ 02_quality_filter.py
â”‚   â”œâ”€â”€ 03_extract_video_latents.py
â”‚   â”œâ”€â”€ 04_extract_struct_latents.py
â”‚   â”œâ”€â”€ 05_extract_flame_params.py
â”‚   â”œâ”€â”€ 06_extract_audio_features.py
â”‚   â”œâ”€â”€ 07_build_metadata.py
â”‚   â””â”€â”€ run_pipeline.sh
â”œâ”€â”€ download/
â”‚   â”œâ”€â”€ download_hdtf.py            # HDTF YouTube ä¸‹è½½
â”‚   â””â”€â”€ download_celebvhq.py        # CelebV-HQ ä¸‹è½½
â””â”€â”€ eval/
    â”œâ”€â”€ compute_fvd.py
    â”œâ”€â”€ compute_fid.py
    â”œâ”€â”€ compute_identity.py
    â”œâ”€â”€ compute_sync.py
    â”œâ”€â”€ compute_pose.py
    â”œâ”€â”€ batch_generate.py
    â””â”€â”€ run_eval.py
```

### ä¿®æ”¹çš„ MOVA åŸæœ‰æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|---------|
| `mova/diffusion/models/wan_video_dit.py` | æ–°å¢ block-causal æ³¨æ„åŠ›æ©ç ï¼ˆ`_build_block_causal_mask`ï¼‰ã€`flash_attention_causal`ã€`causal_temporal` é…ç½® |
| `mova/diffusion/models/__init__.py` | æ³¨å†Œ WanStructModelã€KV-Cacheã€AudioConditioning |
| `mova/diffusion/schedulers/__init__.py` | æ³¨å†Œ DiffusionForcingScheduler |
| `mova/diffusion/pipelines/__init__.py` | æ³¨å†Œ DualForceTrainã€DualForceInference |
| `mova/datasets/__init__.py` | æ³¨å†Œ DualForceDataset |
| `mova/engine/trainer/accelerate/accelerate_trainer.py` | batch-key æ— å…³åŒ–ï¼Œæ–°å¢ DualForce è®­ç»ƒæŒ‡æ ‡ |

---

## äº”ã€å½“å‰é¡¹ç›®çŠ¶æ€æ€»ç»“

### å·²å®Œæˆï¼ˆçº¯ä»£ç å±‚é¢ï¼Œæ— éœ€ GPUï¼‰

| æ¨¡å— | çŠ¶æ€ |
|------|------|
| Phase 0ï¼šç¯å¢ƒæ­å»ºã€MOVA æ¨ç†éªŒè¯ | âœ… å®Œæˆå¹¶éªŒè¯ |
| Phase 1ï¼šæ ¸å¿ƒåŒå¡”æ¶æ„ï¼ˆMOVA-Lite + ç»“æ„ DiT + DF è°ƒåº¦å™¨ï¼‰ | âœ… ä»£ç å®Œæˆ |
| Phase 1ï¼šKV-cacheã€Block-Causal æ³¨æ„åŠ› | âœ… ä»£ç å®Œæˆ |
| Phase 1ï¼šè®­ç»ƒ/æ¨ç†è„šæœ¬ã€FSDP é…ç½® | âœ… ä»£ç å®Œæˆ |
| Phase 2ï¼šæ•°æ®é¢„å¤„ç†æµæ°´çº¿ï¼ˆ7ä¸ªè„šæœ¬ï¼‰ | âœ… ä»£ç å®Œæˆ |
| Phase 3ï¼šéŸ³é¢‘æ¡ä»¶åŒ–ã€DualAdaLNZero | âœ… ä»£ç å®Œæˆ |
| Phase 4ï¼šè®­ç»ƒæŸå¤±ï¼ˆL_video/struct/flame/lip_syncï¼‰ | âœ… ä»£ç å®Œæˆ |
| Phase 5ï¼šè¯„ä¼°æµæ°´çº¿ï¼ˆ5ä¸ªæŒ‡æ ‡ + ç¼–æ’å™¨ï¼‰ | âœ… ä»£ç å®Œæˆ |
| Phase 5.2ï¼š7ç»„æ¶ˆèå®éªŒé…ç½® | âœ… ä»£ç å®Œæˆ |
| ä¸‹è½½/éªŒè¯è„šæœ¬ï¼ˆHDTFã€CelebV-HQï¼‰ | âœ… ä»£ç å®Œæˆ |

**ä»£ç è§„æ¨¡**ï¼š~51 ä¸ªæ–‡ä»¶å˜æ›´ï¼Œçº¦ 12,747 è¡Œæ–°å¢ä»£ç ï¼Œ14 æ¬¡æœ‰æ•ˆåŠŸèƒ½æäº¤

### å¾…å®Œæˆï¼ˆéœ€è¦ GPU æˆ–å¤–éƒ¨èµ„æºï¼‰

| ä¼˜å…ˆçº§ | ä»»åŠ¡ | ä¾èµ– |
|--------|------|------|
| P0 ğŸ”´ | è¿è¡Œ `verify_dualforce.py` éªŒè¯å‰å‘ä¼ æ’­ | GPU ç¯å¢ƒ |
| P0 ğŸ”´ | KV-cache ä¸€è‡´æ€§éªŒè¯ | GPU ç¯å¢ƒ |
| P0 ğŸ”´ | å…¨æµæ°´çº¿å†…å­˜ä¼°ç®—ï¼ˆç›®æ ‡ <50GB VRAM 8Ã—A100ï¼‰ | GPU ç¯å¢ƒ |
| P1 ğŸŸ¡ | ä¸‹è½½ HDTF æ•°æ®é›†ï¼ˆ~362 clipsï¼‰ | ç½‘ç»œï¼ˆYouTube é“¾æ¥æ—¶æ•ˆæ€§å¼ºï¼‰ |
| P1 ğŸŸ¡ | ä¸‹è½½ CelebV-HQï¼ˆ~35K clipsï¼‰ | ç½‘ç»œ |
| P1 ğŸŸ¡ | å®‰è£… LivePortrait + EMOCA | ç»“æ„ç‰¹å¾æå–å‰ç½® |
| P1 ğŸŸ¡ | è¿è¡Œå®Œæ•´é¢„å¤„ç†æµæ°´çº¿ï¼ˆç«¯åˆ°ç«¯éªŒè¯ï¼‰ | HDTF + LivePortrait + EMOCA |
| P2 ğŸŸ¢ | Phase 2 causal è§†é¢‘é¢„è®­ç»ƒï¼ˆ3-5å¤©ï¼Œ8Ã—A100ï¼‰ | æ•°æ® + GPU |
| P2 ğŸŸ¢ | Phase 4 å¤šæ¨¡æ€ DualForce è®­ç»ƒï¼ˆ1-2å‘¨ï¼Œ8Ã—A100ï¼‰ | Phase 2 å®Œæˆ |
| P3 ğŸ”µ | è¿è¡Œ 5 æŒ‡æ ‡è¯„ä¼° + 7 ç»„æ¶ˆèå®éªŒ | è®­ç»ƒå®Œæˆ |
| P3 ğŸ”µ | ä¸ Hallo2/3ã€SadTalkerã€EMO å¯¹æ¯” | è®­ç»ƒå®Œæˆ |
| P3 ğŸ”µ | æ’°å†™è®ºæ–‡ï¼ˆç›®æ ‡ï¼šNeurIPS 2026 / ECCV 2026ï¼‰ | å…¨éƒ¨å®éªŒå®Œæˆ |

---

## å…­ã€æ–‡ä»¶ä½ç½®é€ŸæŸ¥è¡¨

| å†…å®¹ | è·¯å¾„ |
|------|------|
| MOVA-360p æƒé‡ | `autodl-tmp/checkpoints/MOVA-360p/` |
| conda ç¯å¢ƒï¼ˆmovaï¼‰ | `miniconda3/envs/mova/` |
| MOVA æ¨ç†è¾“å‡º | `data/samples/single_person.mp4` |
| DualForce è®­ç»ƒé…ç½® | `configs/dualforce/dualforce_train_8gpu.py` |
| FSDP é…ç½® | `configs/dualforce/accelerate/fsdp_8gpu.yaml` |
| æ¶ˆèå®éªŒé…ç½® | `configs/dualforce/ablations/` |
| æ ¸å¿ƒæ¨¡å‹ä»£ç  | `mova/diffusion/models/wan_struct_dit.py` ç­‰ |
| è®­ç»ƒæµæ°´çº¿ | `mova/diffusion/pipelines/dualforce_train.py` |
| æ¨ç†æµæ°´çº¿ | `mova/diffusion/pipelines/pipeline_dualforce.py` |
| æ•°æ®é›† | `mova/datasets/dualforce_dataset.py` |
| é¢„å¤„ç†è„šæœ¬ | `scripts/preprocess/` |
| ä¸‹è½½è„šæœ¬ | `scripts/download/` |
| è¯„ä¼°è„šæœ¬ | `scripts/eval/` |
| GPU éªŒè¯è„šæœ¬ | `scripts/verify_dualforce.py` |
| è®­ç»ƒå¯åŠ¨è„šæœ¬ | `scripts/training_scripts/dualforce_train_8gpu.sh` |
| å·¥ä½œæ–‡æ¡£ | `cc_todo/` |

---

*æœ¬æ–‡æ¡£ç”± Claude Sonnet 4.6 äº 2026-02-23 æ•´ç†ç”Ÿæˆï¼ŒåŸºäº cc_todo ä¸‹å·²æœ‰æ–‡æ¡£ä¸ git log å†…å®¹æ±‡æ€»ã€‚*
